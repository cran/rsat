<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>1. Search</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">1. Search</h1>



<div id="search" class="section level1">
<h1>Search</h1>
<p>In <code>rsat</code>, <strong>searching</strong> means locating the satellite images of a desired data product for a given region and time of interest (referred to as <em>roi</em> and <em>toi</em> henceforth). Searching requires <strong>getting access</strong> to satellite imagery and <strong>doing a search</strong> (Section 2), i.e. finding, previewing, and filtering the available information for a <em>roi</em> and <em>toi</em>.</p>
<hr />
<div id="Getting-access" class="section level2">
<h2>Getting access</h2>
<div id="profiles" class="section level3">
<h3>Profiles</h3>
<p><code>rsat</code> communicates with two public data archives through their <em>Application Programming Interfaces</em> (<em>APIs</em>). The registration in the following online portals is required to get a full access to satellite images with <code>rsat</code>;</p>
<ul>
<li><a href="https://ers.cr.usgs.gov/register/">USGS</a> USGS is the sole science agency for the Department of the Interior of United States. Provide access to Modis Images. More information about USGS can be found <a href="https://www.usgs.gov/">Here</a>.</li>
<li><a href="https://urs.earthdata.nasa.gov">EarthData</a>: A repository of NASA’s earth observation data-sets. More information about EarthData can be found <a href="https://earthdata.nasa.gov/earth-observation-data">here</a>.</li>
<li><a href="https://scihub.copernicus.eu/dhus/#/self-registration">SciHub</a>, a web service giving access to Copernicus’ scientific data hub. Please go <a href="https://scihub.copernicus.eu/">here</a> to find more details about the data hub.</li>
</ul>
<p>For convenience, try to use the same <em>username</em> and <em>password</em> for all of them. To satisfy the criteria in both web services make sure that the <u><em>username</em> is <span class="math inline">\(4\)</span> characters long and includes a period, number or underscore</u>. The <u><em>password</em> must be <span class="math inline">\(12\)</span> character long and should include characters with at least one capital letter, and numbers</u>.</p>
</div>
<div id="credentials-management" class="section level3">
<h3>Credentials management</h3>
<p>Two functions deal with the <em>usernames</em> and <em>passwords</em> for the various <em>APIs</em> considered in <code>rsat</code>; <code>set_credentials()</code> and <code>print_credentials()</code><em>.</em> The former defines which <code>username</code> (first argument) and <code>password</code> (second argument) should be used for which <code>portal</code> (third argument):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_credentials</span>(<span class="st">&quot;rsat.package&quot;</span>,<span class="st">&quot;UpnaSSG.2021&quot;</span>, <span class="st">&quot;scihub&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set_credentials</span>(<span class="st">&quot;rsat.package&quot;</span>,<span class="st">&quot;UpnaSSG.2021&quot;</span>, <span class="st">&quot;earthdata&quot;</span>)</span></code></pre></div>
<p>The latter prints the <em>usernames</em> and <em>passwords</em> saved during the current <code>R</code> session:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_credentials</span>()</span></code></pre></div>
<p>If <em>usernames</em> and <em>passwords</em> are the same for all the portals, they can be set with a single instruction:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_credentials</span>(<span class="st">&quot;rsat.package&quot;</span>,<span class="st">&quot;UpnaSSG.2021&quot;</span>)</span></code></pre></div>
<hr />
</div>
</div>
<div id="Doing-a-search" class="section level2">
<h2>Doing a search</h2>
<div id="simple-search" class="section level3">
<h3>Simple search</h3>
<div id="finding-data-records" class="section level4">
<h4>Finding data records</h4>
<p>The function <code>rsat_search()</code> performs the search of satellite imagery. One way to use this function is providing; (1) a geo-referenced polygon (<code>sf</code> class object), (2) the initial and final dates of the relevant time period (<code>date</code> vector), and (3) the name(s) of the satellite data product(s) (<code>character</code> vector). <code>rsat</code> gives access to several satellite data products. Among them, the <em>surface reflectance</em> products are frequently used in applied research studies. Their names are:</p>
<ul>
<li><p>for the Landsat program:</p>
<ul>
<li>Landsat 4-5 mission: <code>&quot;LANDSAT_TM_C1&quot;</code></li>
<li>Landsat-7 mission: <code>&quot;LANDSAT_ETM_C1&quot;</code></li>
<li>Landsat-8 mission: <code>&quot;LANDSAT_8_C1&quot;</code></li>
</ul></li>
<li><p>for the MODIS program:</p>
<ul>
<li>Terra satellite: <code>&quot;mod09ga&quot;</code></li>
<li>Aqua satellite: <code>&quot;myd09ga&quot;</code></li>
</ul></li>
<li><p>for the Sentinel program:</p>
<ul>
<li><p>Sentinel-2 mission: <code>&quot;S2MSI2A&quot;</code></p></li>
<li><p>Sentinel-3 mission: <code>&quot;SY_2_SYN___&quot;</code></p></li>
</ul></li>
</ul>
<p>More details about other products and their names can be found <a href="https://www.usgs.gov/landsat-missions/product-information">here</a>, <a href="https://modis.gsfc.nasa.gov/data/dataprod/">here</a>, and <a href="https://sentinel.esa.int/web/sentinel/missions">here</a> for Landsat, MODIS, and Sentinel respectively. The package can search and download other data than multispectral images (e.g., radar) although this goes beyond the scope of the current status of the package.</p>
<p>The following code looks for satellite images (<em>surface reflectance</em>) of a region in norther Spain captured during the first half of January <span class="math inline">\(2021\)</span>, captured by MODIS:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ex.navarre&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>toi <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-01-01&quot;</span>) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">15</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>rcd <span class="ot">&lt;-</span> <span class="fu">rsat_search</span>(<span class="at">region =</span> ex.navarre,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">product =</span> <span class="fu">c</span>(<span class="st">&quot;mod09ga&quot;</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dates =</span> toi)</span></code></pre></div>
<p>A search can involve several products simultaneously. In addition to MODIS, the instruction below also considers images from Sentinel-3:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rcd <span class="ot">&lt;-</span> <span class="fu">rsat_search</span>(<span class="at">region =</span> ex.navarre,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">product =</span> <span class="fu">c</span>(<span class="st">&quot;mod09ga&quot;</span>, <span class="st">&quot;SY_2_SYN___&quot;</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dates =</span> toi)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rcd)</span></code></pre></div>
<p>The output from <code>rsat_search()</code> is a <code>records</code> object. This object stores the search results metadata from the various <em>APIs</em> in standardized manner. A <code>records</code> works as a vector and every element of the vector refers to an image. Information about an image is saved in the following <em>slots</em>:</p>
<ul>
<li>sat (<code>character</code>): name of the satellite (e.g., Landsat, MODIS, Sentinel-2, Sentinel-3, etc.).</li>
<li>name (<code>character</code>): name of the file.</li>
<li>date (<code>Date</code>): capturing date of the image.</li>
<li>product (<code>character</code>): name of the data product.</li>
<li>path (<code>numeric</code>): horizontal location of the tile (MODIS/Landsat only).</li>
<li>row (<code>numeric</code>): vertical location of the tile (MODIS/Landsat only).</li>
<li>tileid (<code>character</code>): tile identification number (Sentinel only).</li>
<li>download (<code>character</code>): download URL.</li>
<li>file_path (<code>character</code>): the relative path for local store of the image.</li>
<li>preview (<code>character</code>): preview URL.</li>
<li>api_name (<code>character</code>): name of the API internally used by <code>rsat</code>.</li>
<li>order (<code>boolean</code>): if <code>TRUE</code>, the image needs to be ordered before the download.</li>
<li>extent_crs (<code>extent_crs</code>): coordinate reference system of the preview.</li>
</ul>
<p>You can extract the most relevant <em>slots</em> from a <code>records</code> using specific functions such as <code>sat_name()</code>, <code>names()</code>, or <code>dates()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sat_name</span>(rcd))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rcd)[<span class="dv">1</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">dates</span>(rcd))</span></code></pre></div>
</div>
</div>
<div id="filtering-search-results" class="section level3">
<h3>Filtering search results</h3>
<p>As mentioned earlier, a <code>records</code> object behaves like a vector. It works with common <code>R</code> methods such as <code>c()</code>, <code>[]</code>, <code>length()</code>, <code>subset()</code>, or <code>unique()</code>. These methods allow to filter and tinker with the search results. Selecting and filtering satellite images is specially powerful when combined with visualization (see below). Discarding useless images at this stage of the process can save memory space and processing time.</p>
<p>For instance, the code below counts the results found from each mission:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod.rcd <span class="ot">&lt;-</span> <span class="fu">subset</span>(rcd, <span class="st">&quot;sat&quot;</span>, <span class="st">&quot;Modis&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sn3.rcd <span class="ot">&lt;-</span> <span class="fu">subset</span>(rcd, <span class="st">&quot;sat&quot;</span>, <span class="st">&quot;Sentinel-3&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(mod.rcd)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(sn3.rcd)</span></code></pre></div>
<p>The first, second, and third argument in <code>subset()</code> correspond to, (1) the <code>records</code> object, (2) the name of the slot used for subsetting, and (3) the value of the slot we are interested in. The next lines of code show a more advance filtering example where a new <code>records</code> is built from images captured by both missions on the same dates:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod.mtch <span class="ot">&lt;-</span> mod.rcd[<span class="fu">dates</span>(mod.rcd) <span class="sc">%in%</span> <span class="fu">dates</span>(sn3.rcd)]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sn3.mtch <span class="ot">&lt;-</span> sn3.rcd[<span class="fu">dates</span>(sn3.rcd) <span class="sc">%in%</span> <span class="fu">dates</span>(mod.rcd)]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>rcd <span class="ot">&lt;-</span> <span class="fu">c</span>(mod.mtch, sn3.mtch)</span></code></pre></div>
<p>A <code>records</code> can be coerced to a <code>data.frame</code> with <code>as.data.frame()</code> and transformed back with <code>as.records()</code>. The rows and columns of the <code>data.frame</code> correspond to the satellite images and their slots respectively:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rcd.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(rcd)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rcd.df)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rcd.df)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rcd &lt;- as.records(rcd.df)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># class(rcd)</span></span></code></pre></div>
</div>
<div id="previewing-search-results" class="section level3">
<h3>Previewing search results</h3>
<p>The <code>rsat</code> package provides a <code>plot()</code> method for satellite <code>records</code>. It displays a preview of the satellite images, i.e a low-resolution versions of the satellite images. Previewing can help to decide whether the actual image, much heavier than the preview, is worth downloading.</p>
<p>Cloudy images are frequently useless and they can be removed from the <code>records</code> object using vector-like methods (see previous section). For instance, the code below displays the first <span class="math inline">\(10\)</span> records and, based on visual evaluation of cloud coverage, it removes the <span class="math inline">\(9^{th}\)</span> image from the <code>records</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>prview <span class="ot">&lt;-</span> <span class="fu">plot</span>(rcd[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>prview</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>rcd <span class="ot">&lt;-</span> rcd[<span class="sc">-</span><span class="dv">9</span>]</span></code></pre></div>
<p>Sometimes, it might be difficult to spot the location of the region of interest on the previews. The <em>roi</em> polygon can be passed to the <code>plot()</code> function using the <code>region</code> argument. Additionally, the <code>plot()</code> method in <code>rsat</code> is a wrapper function of <code>tmap</code> and it accepts other inputs from <code>tm_raster()</code> and <code>tm_polygon()</code>. These arguments should be preceded by the <code>tm.raster</code> and <code>tm.polygon</code> identifiers.</p>
<p>The instruction below leverages the preview to its fullest. It shows the <em>RGB</em> satellite image preview with the <em>roi</em> superposed (), with a red border color (<code>tm.polygon.region.border.col = &quot;red&quot;</code>) and no fill (<code>tm.polygon.region.alpha = 0</code>). The compass (<code>compass.rm = TRUE</code>) and scale bar (<code>scale.bar.rm = TRUE</code>) are removed:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rcd[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">region =</span> ex.navarre,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">tm.polygon.region.border.col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">tm.polygon.region.alpha =</span> <span class="dv">0</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">compass.rm =</span> T,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">scale.bar.rm =</span> T)</span></code></pre></div>
<hr />
</div>
</div>
<div id="advanced-search" class="section level2">
<h2>Advanced search</h2>
<div id="the-rtoi" class="section level3">
<h3>The <code>rtoi</code></h3>
<p>Sometimes, regions are located at the intersection of images or they are too large to fit in a single scene. In these situations, working with separate files might be cumbersome. As a solution, <code>rsat</code> provides the <code>rtoi</code> class object. An <code>rtoi</code> is a project or study-case which is associated with a <em>region and time of interest</em> (hence its name). An <code>rtoi</code> consists of the following elements:</p>
<ol style="list-style-type: decimal">
<li><code>name</code>: a project identifier.</li>
<li><code>region</code>: a georeferenced polygon (<code>sf</code> class object).</li>
<li><code>db_path</code>: the path to a database, i.e. a folder for raw satellite images which have generic purposes.</li>
<li><code>rtoi_path</code>: the path to a dataset, i.e. a folder for customized/processed.</li>
<li><code>records</code>: a vector of satellite records relevant for the study.</li>
</ol>
<p>As a showcase, we’ll assess the effects of the <a href="https://en.wikipedia.org/wiki/2020%E2%80%9321_European_windstorm_season#Storm_Filomena">Storm Filomena</a> over the Iberian peninsula in terms of snow coverage. The storm was an extreme meteorological event (largest since 1971, according to <a href="http://www.aemet.es/en/portada"><em>AEMET</em></a>). The storm swept the peninsula from January <span class="math inline">\(6^{th}\)</span> and <span class="math inline">\(11^{th}\)</span>, <span class="math inline">\(2021\)</span>. The code below generates a bounding box around the peninsula (<code>ip</code>) and limits the study period (<code>toi</code>) to the immediate dates after the storm:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ip <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(<span class="fu">c</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">9.755859</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmax =</span>  <span class="fl">4.746094</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymin =</span> <span class="fl">35.91557</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymax =</span> <span class="fl">44.02201</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>), <span class="at">crs =</span> <span class="dv">4326</span>)))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>toi <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-01-10&quot;</span>),<span class="fu">as.Date</span>(<span class="st">&quot;2021-01-15&quot;</span>),<span class="dv">1</span>)</span></code></pre></div>
<p>A new <code>rtoi</code> requires at least the elements from <span class="math inline">\(1\)</span> to <span class="math inline">\(4\)</span>. The following lines generate programmatically the database and dataset folders:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>db.path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;database&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ds.path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;datasets&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(db.path)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(ds.path)</span></code></pre></div>
<p>The function <code>new_rtoi()</code> builds a new <code>rtoi</code> from the elements mentioned above:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>filomena <span class="ot">&lt;-</span> <span class="fu">new_rtoi</span>(<span class="at">name =</span> <span class="st">&quot;filomena&quot;</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> ip,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">db_path =</span> db.path,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rtoi_path =</span> ds.path)</span></code></pre></div>
<p>The <code>new_rtoi()</code> function writes a set of files representing a copy of the <code>R</code> object (filomena.rtoi) and a shapefile of the <em>roi</em> (region):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rtoi.files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">file.path</span>(ds.path, <span class="st">&quot;filomena&quot;</span>), <span class="at">full.name =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rtoi.files</span></code></pre></div>
<p>This file is updated whenever the <code>rtoi</code> is modified. Thus, if the <code>R</code> session accidentally breaks or closes, the last version of the <code>rtoi</code> is saved in you hard drive and can be loaded with <code>read_rtoi()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>filomena <span class="ot">&lt;-</span> <span class="fu">read_rtoi</span>(<span class="fu">file.path</span>(ds.path, <span class="st">&quot;filomena&quot;</span>))</span></code></pre></div>
<p>Printing the <code>rtoi</code> provides a summary about the region and time of interest, a summary of the relevant <code>records</code> for the analysis, and the paths to the database and the dataset:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(filomena)</span></code></pre></div>
</div>
<div id="search-with-an-rtoi" class="section level3">
<h3>Search with an <code>rtoi</code></h3>
<p>You can use an <code>rtoi</code> to search satellite images with <code>rsat_search()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>toi <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-01-10&quot;</span>) <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rsat_search</span>(<span class="at">region =</span> filomena,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">product =</span> <span class="fu">c</span>(<span class="st">&quot;mod09ga&quot;</span>, <span class="st">&quot;SY_2_SYN___&quot;</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">dates =</span> toi)</span></code></pre></div>
<p>An <code>rtoi</code> is an S6 class object, so it behaves like any object in other programming languages. That is, if the <code>rtoi</code> is passed as an argument and modifies the <code>rtoi</code>, the object in the main environment is also updated. The function <code>rsat_search()</code> places the resulting <code>records</code> into the <code>rtoi</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(filomena)</span></code></pre></div>
<p>Since the <code>rtoi</code> has been modified, the <code>rtoi.file</code> has also been updated:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(rtoi.files[<span class="dv">1</span>])<span class="sc">$</span>ctime <span class="co"># creation time</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.info</span>(rtoi.files[<span class="dv">1</span>])<span class="sc">$</span>mtime <span class="co"># modification time</span></span></code></pre></div>
<p>To extract the <code>records</code> from the <code>rtoi</code> use <code>records()</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rcds <span class="ot">&lt;-</span> <span class="fu">records</span>(filomena)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rcds)</span></code></pre></div>
<p>If you want to apply further filters on the results, as shown in the previous section, you need to extract the <code>records</code> from the <code>rtoi</code> first and then apply <code>c()</code>, <code>[]</code>, <code>subset()</code>, and <code>length()</code> at your convenience.</p>
</div>
<div id="displaying-results" class="section level3">
<h3>Displaying results</h3>
<p>There is a <code>plot()</code> method too for <code>rtoi</code>s but it is more sophisticated. There is a <code>&quot;preview&quot;</code> mode that shows the low-resolution <em>RGB</em> version of the satellite images. The plot binds together the satellite images available for a given date and <code>roi</code>, and the function allows other arguments, such as <code>product</code> or <code>dates</code>, to better select the information being shown:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filomena,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">&quot;preview&quot;</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">product =</span> <span class="st">&quot;mod09ga&quot;</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">dates =</span> <span class="st">&quot;2021-01-11&quot;</span>)</span></code></pre></div>
<p><code>rtoi</code>s are designed save information from several missions. The <code>mode = &quot;dates&quot;</code> prints a calendar indicating the availability of satellite images from one or multiple missions during the time of interest:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filomena, <span class="st">&quot;dates&quot;</span>)</span></code></pre></div>
<p>The following vignette explains how to download the satellite images and the role of the <em>database</em> when managing multiple <code>rtoi</code>s. To reduce the processing times and memory space, the showcase is restricted to MODIS images from here onward:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rcd <span class="ot">&lt;-</span> <span class="fu">records</span>(filomena)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">records</span>(filomena) <span class="ot">&lt;-</span> <span class="fu">subset</span>(rcd, <span class="st">&quot;product&quot;</span>, <span class="st">&quot;mod09ga&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
